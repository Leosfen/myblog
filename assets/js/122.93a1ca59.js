(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{131:function(e,l,r){"use strict";r.r(l);var o=r(0),t=Object(o.a)({},function(){var e=this,l=e.$createElement,r=e._self._c||l;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h4",{attrs:{id:"题目：zookeeper同步流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#题目：zookeeper同步流程","aria-hidden":"true"}},[e._v("#")]),e._v(" "),r("strong",[e._v("题目")]),e._v("：zookeeper同步流程")]),e._v(" "),r("h4",{attrs:{id:"参考答案："}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考答案：","aria-hidden":"true"}},[e._v("#")]),e._v(" "),r("strong",[e._v("参考答案")]),e._v("：")]),e._v(" "),r("p",[e._v("选完Leader以后，zk就进入状态同步过程。")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("Leader等待Follower和Observer连接；")])]),e._v(" "),r("li",[r("p",[e._v("Follower连接leader，将最大的zxid发送给leader；")])]),e._v(" "),r("li",[r("p",[e._v("Leader根据follower的zxid确定同步点；")])]),e._v(" "),r("li",[r("p",[e._v("完成同步后通知follower 已经成为uptodate状态；")])]),e._v(" "),r("li",[r("p",[e._v("Follower收到uptodate消息后，又可以重新接受client的请求进行服务了。")])])]),e._v(" "),r("img",{attrs:{src:"zk_sync.png"}}),e._v(" "),r("p",[e._v("数据同步的4种方式：")]),e._v(" "),r("p",[e._v("1、SNAP-全量同步")]),e._v(" "),r("ul",[r("li",[e._v("条件：peerLastZxid<minCommittedLog")]),e._v(" "),r("li",[e._v("说明：证明二者数据差异太大，follower数据过于陈旧，leader发送快照SNAP指令给follower全量同步数据，即leader将所有数据全量同步到follower")])]),e._v(" "),r("p",[e._v("2、DIFF-增量同步")]),e._v(" "),r("ul",[r("li",[e._v("条件：minCommittedLog<=peerLastZxid<=maxCommittedLog")]),e._v(" "),r("li",[e._v("说明：证明二者数据差异不大，follower上有一些leader上已经提交的提议proposal未同步，此时需要增量提交这些提议即可")])]),e._v(" "),r("p",[e._v("3、TRUNC-仅回滚同步")]),e._v(" "),r("ul",[r("li",[e._v("条件：peerLastZxid>minCommittedLog")]),e._v(" "),r("li",[e._v("说明：证明follower上有些提议proposal并未在leader上提交，follower需要回滚到zxid为minCommittedLog对应的事务操作")])]),e._v(" "),r("p",[e._v("4、TRUNC+DIFF-回滚+增量同步")]),e._v(" "),r("ul",[r("li",[e._v("条件：minCommittedLog<=peerLastZxid<=maxCommittedLog")]),e._v(" "),r("li",[e._v("说明：leader a已经将事务truncA提交到本地事务日志中，但没有成功发起proposal协议进行投票就宕机了；然后集群中剔除原leader a重新选举出新leader b，又提交了若干新的提议proposal，然后原leader a重新服务又加入到集群中说明：此时a,b都有一些对方未提交的事务，若b是leader, a需要先回滚truncA然后增量同步新leader b上的数据。")])])])},[],!1,null,null,null);l.default=t.exports}}]);